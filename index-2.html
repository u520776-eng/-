<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>è¬å¾·èŠåš´ - åŠŸå¾·ç‰ˆ</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* å®šç¾©ä¸»é¡Œé¡è‰²èˆ‡è®Šé‡ */
        :root { --gold: #fbbf24; --bg: #020617; --sun-glow: rgba(251, 191, 36, 0.6); }
        
        /* åŸºç¤æ¨£å¼é‡ç½® */
        * { font-family: "PingFang TC", "Heiti TC", sans-serif !important; -webkit-tap-highlight-color: transparent; user-select: none; box-sizing: border-box; touch-action: manipulation; }
        body { background-color: var(--bg); color: white; margin: 0; padding: 0; overflow: hidden; height: 100vh; width: 100vw; position: fixed; }

        /* å’’è¼ªæ—‹è½‰å‹•ç•«ï¼šå…¨éƒ¨å‘å³æ—‹è½‰ (é †æ™‚é‡) */
        .wheel-container { position: absolute; transform-origin: center center; pointer-events: none; }
        .wheel-outer { width: 340px; height: 340px; animation: rotate-cw 120s linear infinite; }
        .wheel-mid { width: 260px; height: 260px; animation: rotate-cw 80s linear infinite; }
        .wheel-inner { width: 180px; height: 180px; animation: rotate-cw 40s linear infinite; }

        @keyframes rotate-cw { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* ä½›åå–®ä½æ¨£å¼ */
        .chant-unit { position: absolute; left: 50%; top: 50%; white-space: nowrap; font-weight: 900; transition: all 0.5s ease; pointer-events: none; color: rgba(180, 83, 9, 0.2); }
        /* é»äº®ç‹€æ…‹ï¼šæ¯å¿µä¸€è²å‰‡é€æ­¥è®Šè‰²é»äº® */
        .active-unit { color: var(--gold) !important; filter: drop-shadow(0 0 5px var(--gold)); opacity: 1 !important; transform-origin: center; scale: 1.1; }

        /* é»æ“Šè¦–è¦ºæ•ˆæœï¼šæ¼£æ¼ªèˆ‡é–ƒå…‰ */
        .ripple { position: absolute; border-radius: 50%; border: 2px solid var(--gold); pointer-events: none; z-index: 80; transform: translate(-50%, -50%); animation: ripple-out 1.5s cubic-bezier(0.1, 0, 0.2, 1) forwards; }
        @keyframes ripple-out { 0% { width: 0; height: 0; opacity: 1; } 100% { width: 600px; height: 600px; opacity: 0; } }

        .sun-flash { position: absolute; border-radius: 50%; background: radial-gradient(circle, var(--sun-glow) 0%, transparent 70%); pointer-events: none; z-index: 70; transform: translate(-50%, -50%); animation: flash-fade 0.8s ease-out forwards; }
        @keyframes flash-fade { 0% { width: 0; height: 0; opacity: 1; } 100% { width: 300px; height: 300px; opacity: 0; } }

        /* æ ¸å¿ƒå¤ªé™½æŒ‰éˆ•æ¨£å¼ */
        .sun-button {
            width: 76px; height: 76px;
            background: radial-gradient(circle, #fcd34d 0%, #fbbf24 50%, #d97706 100%);
            border-radius: 50%;
            box-shadow: 0 0 25px var(--sun-glow);
            display: flex; align-items: center; justify-content: center;
            position: relative; transition: transform 0.1s;
            cursor: pointer; z-index: 500;
        }
        .sun-button:active { transform: scale(0.92); }

        /* UI æŒ‰éˆ•é€šç”¨æ¨£å¼ */
        .ui-btn { transition: all 0.2s ease; color: #94a3b8; font-weight: bold; font-size: 0.7rem; letter-spacing: 0.1em; padding: 10px; z-index: 500; cursor: pointer; text-align: center; }
        .ui-btn:active { color: var(--gold); transform: scale(0.9); }

        /* æ¨¡æ…‹å½ˆçª—åŸºç¤æ¨£å¼ */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.92); backdrop-filter: blur(8px); z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: #0f172a; border: 1px solid rgba(251,191,36,0.3); border-radius: 24px; padding: 28px; width: 100%; max-width: 320px; position: relative; }

        /* é€šçŸ¥æé†’æ¨£å¼ */
        #notification { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); background: rgba(15, 23, 42, 0.95); color: var(--gold); padding: 10px 24px; border-radius: 99px; font-size: 13px; z-index: 3000; transition: top 0.5s ease; border: 1px solid var(--gold); }
        #notification.show { top: 60px; }
    </style>
</head>

<body onpointerdown="app.handleInput(event)">

    <div id="app-root" class="relative h-screen w-screen flex flex-col">
        <!-- é ‚éƒ¨é€šçŸ¥ -->
        <div id="notification">ä¿®è¡Œæé†’</div>

        <!-- åˆå§‹é¸æ“‡ä»‹é¢ (é¦–é ) -->
        <div id="home-view" class="fixed inset-0 z-[1000] flex flex-col items-center justify-center p-8 bg-[#020617]">
            <div class="mb-10 text-center">
                <h1 class="text-3xl font-black tracking-[0.6em] text-amber-500 mb-3 ml-[0.6em]">è¬å¾·èŠåš´</h1>
                <p class="text-stone-500 text-xs tracking-[0.2em]">å°ˆæ³¨ç•¶ä¸‹ï¼Œä¸€å¿ƒä¿®æŒ</p>
            </div>
            <div class="grid grid-cols-1 gap-4 w-full max-w-xs">
                <button onclick="app.select('å—ç„¡é˜¿å½Œé™€ä½›')" class="bg-white/5 border border-amber-900/30 p-5 rounded-2xl active:bg-amber-600/20"><div class="text-amber-500 text-lg font-bold">å—ç„¡é˜¿å½Œé™€ä½›</div></button>
                <button onclick="app.select('å—ç„¡è§€ä¸–éŸ³è©è–©')" class="bg-white/5 border border-white/5 p-5 rounded-2xl active:bg-white/10"><div class="text-amber-500 text-lg font-bold">å—ç„¡è§€ä¸–éŸ³è©è–©</div></button>
                <button onclick="app.select('å—ç„¡åœ°è—ç‹è©è–©')" class="bg-white/5 border border-white/5 p-5 rounded-2xl active:bg-white/10"><div class="text-amber-500 text-lg font-bold">å—ç„¡åœ°è—ç‹è©è–©</div></button>
                <button onclick="app.select('å—¡å˜›å‘¢å”„ç¾å½')" class="bg-white/5 border border-white/5 p-5 rounded-2xl active:bg-white/10"><div class="text-amber-500 text-lg font-bold">å—¡å˜›å‘¢å”„ç¾å½</div></button>
            </div>
        </div>

        <!-- ä¿®æŒç·´ç¿’ä»‹é¢ -->
        <div id="practice-ui" class="hidden flex-1 flex flex-col">
            <!-- é ‚éƒ¨æ•¸æ“šç‹€æ…‹æ¬„ -->
            <div class="flex justify-between items-start p-8 pt-14 pointer-events-none z-[100]">
                <div>
                    <h1 id="grade-label" class="text-xl font-black text-amber-500 tracking-widest">ä¸‹å“ä¸‹ç”Ÿ</h1>
                    <p id="grade-type" class="text-[9px] text-stone-500 mt-1 tracking-[0.1em]">ä¹å“å¾€ç”Ÿä¿®è¡ŒéŒ„</p>
                </div>
                <div class="text-right">
                    <p class="text-[9px] text-stone-500 tracking-tighter uppercase">ä»Šæ—¥ / ç´¯è¨ˆ</p>
                    <p class="text-lg font-bold text-white">
                        <span id="today-count" class="text-amber-400">0</span>
                        <span class="mx-1 text-stone-700">/</span>
                        <span id="total-count">0</span>
                    </p>
                </div>
            </div>

            <!-- ä¸­å¤®è¦–è¦ºå€ï¼šå’’è¼ªèˆ‡ä½›è™Ÿ -->
            <main class="flex-1 flex items-center justify-center relative pointer-events-none">
                <div id="wheel-outer" class="wheel-container wheel-outer"></div>
                <div id="wheel-mid" class="wheel-container wheel-mid"></div>
                <div id="wheel-inner" class="wheel-container wheel-inner"></div>
                <div id="centerMantra" class="absolute text-amber-400 font-bold text-xl text-center leading-relaxed drop-shadow-[0_0_15px_rgba(251,191,36,0.8)] max-w-[160px]"></div>
            </main>

            <!-- åº•éƒ¨å°èˆªåŠŸèƒ½å€ -->
            <div class="relative pb-10 flex flex-col items-center">
                <div class="flex items-center justify-around w-full max-w-sm px-2 mb-4">
                    <button onclick="app.goHome(event)" class="ui-btn w-14">è¿”å›</button>
                    <button onclick="app.openModal('merit')" class="ui-btn w-14">åŠŸå¾·</button>

                    <!-- ä¸­å¤®å¤ªé™½è§¸æ§æŒ‰éˆ• -->
                    <div id="sun-trigger" class="sun-button">
                        <svg viewBox="0 0 24 24" class="w-8 h-8 text-white/90 fill-current">
                            <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0a.996.996 0 000-1.41l-1.06-1.06zm1.06-12.37a.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06c.39-.38.39-1.02 0-1.41zm-12.37 12.37l-1.06 1.06c-.39.39-.39 1.03 0 1.41a.996.996 0 001.41 0l1.06-1.06c.39-.39.39-1.03 0-1.41a.996.996 0 00-1.41 0z"></path>
                        </svg>
                    </div>

                    <button onclick="app.openModal('dedication')" class="ui-btn w-14">è¿´å‘</button>
                    <!-- æ–°å¢ï¼šæ­¸é›¶éµèˆ‡èªªæ˜éµ -->
                    <div class="flex flex-col">
                        <button onclick="app.openModal('reset')" class="ui-btn w-14 !py-1 text-red-500/70 active:text-red-500">æ­¸é›¶</button>
                        <button onclick="app.openModal('desc')" class="ui-btn w-14 !py-1">èªªæ˜</button>
                    </div>
                </div>
                <div class="text-[9px] text-stone-700 tracking-[0.4em] italic">æ¯ 108 è² åœ“æ»¿ç’°ç¹</div>
            </div>
        </div>
    </div>

    <!-- åœ“æ»¿æç¤ºå½ˆçª— -->
    <div id="modal-complete" class="modal-overlay">
        <div class="modal-content text-center">
            <div class="text-4xl mb-4">ğŸ™</div>
            <h2 class="text-amber-500 font-bold text-xl mb-2">åŠŸå¾·åœ“æ»¿</h2>
            <p id="complete-msg" class="text-stone-300 text-sm mb-6"></p>
            <div class="flex flex-col gap-3">
                <button onclick="app.closeModal('complete')" class="w-full py-3 bg-amber-600/20 text-amber-500 rounded-xl font-bold">ç¹¼çºŒä¿®æŒ</button>
                <button onclick="app.handleDedicateExit()" class="w-full py-3 bg-white/5 text-stone-400 rounded-xl">é›¢é–‹è¿´å‘</button>
            </div>
        </div>
    </div>

    <!-- åŠŸå¾·çµ±è¨ˆæ¸…å–®å½ˆçª— -->
    <div id="modal-merit" class="modal-overlay" onclick="app.closeModal('merit')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h2 class="text-amber-500 font-bold text-lg mb-4 text-center">åŠŸå¾·çµ±è¨ˆ</h2>
            <div id="merit-list" class="space-y-4 max-h-[300px] overflow-y-auto pr-2"></div>
            <button onclick="app.closeModal('merit')" class="mt-6 w-full py-3 bg-amber-600/20 text-amber-500 rounded-xl font-bold">éš¨å–œåŠŸå¾·</button>
        </div>
    </div>

    <!-- è¿´å‘åˆé¡¯ç¤ºå½ˆçª— -->
    <div id="modal-dedication" class="modal-overlay" onclick="app.closeModal('dedication')">
        <div class="modal-content text-center" onclick="event.stopPropagation()">
            <h2 class="text-amber-500 font-bold text-lg mb-4">è¿´å‘åˆ</h2>
            <div class="text-stone-300 text-sm leading-loose tracking-widest italic">
                é¡˜ä»¥æ­¤åŠŸå¾·ï¼ŒèŠåš´ä½›æ·¨åœŸã€‚<br>
                ä¸Šå ±å››é‡æ©ï¼Œä¸‹æ¿Ÿä¸‰é€”è‹¦ã€‚<br>
                è‹¥æœ‰è¦‹èè€…ï¼Œæ‚‰ç™¼è©æå¿ƒã€‚<br>
                ç›¡æ­¤ä¸€å ±èº«ï¼ŒåŒç”Ÿæ¥µæ¨‚åœ‹ã€‚
            </div>
            <button onclick="app.closeModal('dedication')" class="mt-8 w-full py-3 bg-amber-600/20 text-amber-500 rounded-xl font-bold">èª å¿ƒè¿´å‘</button>
        </div>
    </div>

    <!-- ä¿®æŒèªªæ˜å½ˆçª— -->
    <div id="modal-desc" class="modal-overlay" onclick="app.closeModal('desc')">
        <div class="modal-content text-stone-300 text-sm leading-relaxed" onclick="event.stopPropagation()">
            <h2 class="text-amber-500 font-bold text-lg mb-4 text-center">ä¿®æŒèªªæ˜</h2>
            <p>1. é»æ“Šè¢å¹•ä»»ä½•è™•çš†å¯è¨˜éŒ„ä¸€è²è–è™Ÿã€‚<br>2. å’’è¼ªæ¯ 108 éç‚ºä¸€å€‹åœ“æ»¿å¾ªç’°ï¼Œæ–‡å­—å°‡é€æ¬¡é»äº®ã€‚<br>3. é˜¿å½Œé™€ä½›å°æ‡‰ã€Œä¹å“å¢ƒç•Œã€ï¼Œå…¶é¤˜å°æ‡‰ã€Œéšä½å¢ƒç•Œã€ã€‚<br>4. æ­¸é›¶éµåƒ…æœƒé‡è¨­ç›®å‰é¸å®šè–è™Ÿçš„è¨˜éŒ„ã€‚</p>
            <button onclick="app.closeModal('desc')" class="mt-6 w-full py-3 bg-amber-600/20 text-amber-500 rounded-xl font-bold">çŸ¥é“äº†</button>
        </div>
    </div>

    <!-- æ­¸é›¶ç¢ºèªå½ˆçª— -->
    <div id="modal-reset" class="modal-overlay" onclick="app.closeModal('reset')">
        <div class="modal-content text-center" onclick="event.stopPropagation()">
            <div class="text-3xl mb-4 text-red-500/80">âš ï¸</div>
            <h2 class="text-amber-500 font-bold text-lg mb-2">æ­¸é›¶ç¢ºèª</h2>
            <p class="text-stone-300 text-sm mb-6 leading-relaxed">ç¢ºå®šè¦å°‡ç›®å‰è–è™Ÿçš„<br>ã€Œä»Šæ—¥èˆ‡ç´¯è¨ˆã€åŠŸå¾·æ­¸é›¶å—ï¼Ÿ<br><span class="text-[10px] text-stone-500">(æ­¤æ“ä½œç„¡æ³•æ’¤å›)</span></p>
            <div class="flex gap-3">
                <button onclick="app.closeModal('reset')" class="flex-1 py-3 bg-white/5 text-stone-400 rounded-xl">å–æ¶ˆ</button>
                <button onclick="app.confirmReset()" class="flex-1 py-3 bg-red-900/20 text-red-500 rounded-xl font-bold">ç¢ºå®šæ­¸é›¶</button>
            </div>
        </div>
    </div>

    <script>
        const app = {
            state: {
                currentChant: '',
                data: JSON.parse(localStorage.getItem('buddha_counts_v3') || '{}'),
                grades_9: ["ä¸‹å“ä¸‹ç”Ÿ", "ä¸‹å“ä¸­ç”Ÿ", "ä¸‹å“ä¸Šç”Ÿ", "ä¸­å“ä¸‹ç”Ÿ", "ä¸­å“ä¸­ç”Ÿ", "ä¸­å“ä¸Šç”Ÿ", "ä¸Šå“ä¸‹ç”Ÿ", "ä¸Šå“ä¸­ç”Ÿ", "ä¸Šå“ä¸Šç”Ÿ", "è“®é–‹è¦‹ä½›", "åœ“æ»¿æœä½"]
            },

            // é¸æ“‡è–è™Ÿä¸¦åˆå§‹åŒ–
            select(name) {
                this.state.currentChant = name;
                if (!this.state.data[name]) {
                    this.state.data[name] = { today: 0, total: 0 };
                }
                
                document.getElementById('home-view').classList.add('hidden');
                document.getElementById('practice-ui').classList.remove('hidden');
                
                const centerEl = document.getElementById('centerMantra');
                centerEl.innerText = name;

                this.renderAllWheels();
                this.updateUI();
                this.notify(`å·²åˆ‡æ›è‡³ï¼š${name}`);
            },

            // è™•ç†å…¨å±€é»æ“Šè¼¸å…¥
            handleInput(e) {
                if (e.target.closest('.ui-btn') || e.target.closest('.modal-content') || e.target.closest('#home-view')) return;
                this.count(e.clientX || e.touches?.[0].clientX, e.clientY || e.touches?.[0].clientY);
            },

            // è¨ˆæ•¸é‚è¼¯
            count(x, y) {
                const chant = this.state.currentChant;
                if (!chant) return;

                const d = this.state.data[chant];
                d.today++;
                d.total++;
                this.save(); // è‡ªå‹•å„²å­˜
                
                this.createEffect(x, y);
                this.updateUI();
                this.updateWheelHighlight();
                
                if (navigator.vibrate) navigator.vibrate(12);

                // æ¯ 108 æ¬¡è§¸ç™¼åœ“æ»¿
                if (d.today % 108 === 0) {
                    this.showCompletionModal();
                }
            },

            // æ›´æ–° UI æ•¸æ“šé¡¯ç¤º
            updateUI() {
                const chant = this.state.currentChant;
                const d = this.state.data[chant];
                document.getElementById('today-count').innerText = d.today;
                document.getElementById('total-count').innerText = d.total;
                
                const stage = Math.floor(d.total / 108);
                const label = document.getElementById('grade-label');
                const typeLabel = document.getElementById('grade-type');

                if (chant === 'å—ç„¡é˜¿å½Œé™€ä½›') {
                    label.innerText = this.state.grades_9[Math.min(stage, 10)];
                    typeLabel.innerText = "ä¹å“å¾€ç”Ÿä¿®è¡ŒéŒ„";
                } else {
                    label.innerText = `ç¬¬ ${stage + 1} éš`;
                    typeLabel.innerText = "ä¿®æŒåŠŸå¾·éšä½";
                }
            },

            // æ­¸é›¶ç¢ºèªé‚è¼¯
            confirmReset() {
                const chant = this.state.currentChant;
                if (this.state.data[chant]) {
                    this.state.data[chant].today = 0;
                    this.state.data[chant].total = 0;
                    this.save();
                    this.updateUI();
                    this.updateWheelHighlight();
                    this.closeModal('reset');
                    this.notify(`${chant} è¨˜éŒ„å·²æ­¸é›¶`);
                }
            },

            // æ›´æ–°å’’è¼ªäº®ç‡ˆé‚è¼¯ (ç´¯ç©é»äº® 108)
            updateWheelHighlight() {
                const chant = this.state.currentChant;
                const todayCount = this.state.data[chant].today;
                const progress = ((todayCount - 1) % 108) + 1;

                const applyHighlight = (id, unitsPerGroup) => {
                    const wheel = document.getElementById(id);
                    const units = wheel.querySelectorAll('.chant-unit');
                    const totalGroups = units.length / unitsPerGroup;
                    const numToLight = Math.ceil((progress / 108) * totalGroups);

                    units.forEach((u, i) => {
                        const groupIdx = Math.floor(i / unitsPerGroup);
                        if (groupIdx < numToLight) {
                            u.classList.add('active-unit');
                        } else {
                            u.classList.remove('active-unit');
                        }
                    });
                };

                const nameLen = chant.length;
                applyHighlight('wheel-outer', nameLen);
                applyHighlight('wheel-mid', nameLen);
                applyHighlight('wheel-inner', nameLen);
            },

            // æ¸²æŸ“å¤šåœˆå’’è¼ª
            renderAllWheels() {
                const chant = this.state.currentChant;
                const len = chant.length;
                this.createWheel('wheel-outer', 170, Math.floor(54 / len) * len);
                this.createWheel('wheel-mid', 130, Math.floor(36 / len) * len);
                this.createWheel('wheel-inner', 90, Math.floor(24 / len) * len);
                this.updateWheelHighlight();
            },

            createWheel(id, radius, count) {
                const wheel = document.getElementById(id);
                wheel.innerHTML = '';
                const mantra = this.state.currentChant;
                for (let i = 0; i < count; i++) {
                    const angle = (i / count) * 2 * Math.PI;
                    const el = document.createElement('div');
                    el.className = 'chant-unit';
                    el.style.fontSize = radius > 100 ? '10px' : '12px';
                    el.innerText = mantra[i % mantra.length];
                    const tx = radius * Math.cos(angle);
                    const ty = radius * Math.sin(angle);
                    const rotation = (angle * 180 / Math.PI) + 90;
                    el.style.transform = `translate(-50%, -50%) translate(${tx}px, ${ty}px) rotate(${rotation}deg)`;
                    wheel.appendChild(el);
                }
            },

            // é»æ“Šç‰¹æ•ˆ
            createEffect(x, y) {
                const ripple = document.createElement('div');
                ripple.className = 'ripple';
                ripple.style.left = x + 'px'; ripple.style.top = y + 'px';
                document.body.appendChild(ripple);

                const flash = document.createElement('div');
                flash.className = 'sun-flash';
                flash.style.left = x + 'px'; flash.style.top = y + 'px';
                document.body.appendChild(flash);

                setTimeout(() => { ripple.remove(); flash.remove(); }, 1500);
            },

            // é¡¯ç¤ºåœ“æ»¿å½ˆçª—
            showCompletionModal() {
                const chant = this.state.currentChant;
                const d = this.state.data[chant];
                const stage = Math.floor(d.today / 108);
                const gradeName = chant === 'å—ç„¡é˜¿å½Œé™€ä½›' ? this.state.grades_9[Math.min(stage-1, 10)] : `ç¬¬ ${stage} éš`;
                
                document.getElementById('complete-msg').innerText = `å·²åœ“æ»¿ï¼š${gradeName}`;
                document.getElementById('modal-complete').style.display = 'flex';
            },

            // é›¢é–‹ä¸¦è¿´å‘
            handleDedicateExit() {
                this.closeModal('complete');
                this.openModal('dedication');
                setTimeout(() => {
                    this.closeModal('dedication');
                    this.goHome();
                }, 3000);
            },

            openModal(type) {
                document.getElementById(`modal-${type}`).style.display = 'flex';
                if (type === 'merit') this.renderMerit();
            },

            closeModal(type) {
                document.getElementById(`modal-${type}`).style.display = 'none';
            },

            // æ¸²æŸ“åŠŸå¾·çµ±è¨ˆæ¸…å–®
            renderMerit() {
                const list = document.getElementById('merit-list');
                list.innerHTML = '';
                Object.entries(this.state.data).forEach(([name, d]) => {
                    const row = document.createElement('div');
                    row.className = "flex justify-between items-center bg-white/5 p-4 rounded-xl border border-white/5";
                    row.innerHTML = `
                        <div class="text-amber-500 font-bold">${name}</div>
                        <div class="text-right">
                            <div class="text-[10px] text-stone-500">ç´¯è¨ˆä¿®æŒ</div>
                            <div class="text-white font-mono">${d.total}</div>
                        </div>
                    `;
                    list.appendChild(row);
                });
            },

            // è¿”å›é¦–é 
            goHome(e) {
                if (e) e.stopPropagation();
                document.getElementById('home-view').classList.remove('hidden');
                document.getElementById('practice-ui').classList.add('hidden');
            },

            // å„²å­˜è‡³æœ¬åœ°ç©ºé–“
            save() {
                localStorage.setItem('buddha_counts_v3', JSON.stringify(this.state.data));
            },

            // é€šçŸ¥æé†’
            notify(msg) {
                const n = document.getElementById('notification');
                n.innerText = msg;
                n.classList.add('show');
                setTimeout(() => n.classList.remove('show'), 3000);
            }
        };

        // ç¦æ­¢ iOS ç­‰è¨­å‚™çš„æ©¡çš®ç­‹å›å½ˆæ•ˆæœ
        document.body.addEventListener('touchmove', (e) => {
            if (!e.target.closest('.modal-content') && !e.target.closest('#merit-list')) e.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>

